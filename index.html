<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BVG Echtzeit – Hahneberg & Reimerweg</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0e0e10; --panel:#151518; --text:#e9e9ef; --muted:#a1a1aa;
    --accent:#0dd3ff; --warn:#ff6b6b; --ok:#4caf50; --border:#242428; --bvg:#ffd200;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
       font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;}
  .wrap{max-width:1100px;margin:0 auto;min-height:100%;display:flex;flex-direction:column}
  header{position:sticky;top:0;z-index:3;display:flex;justify-content:space-between;align-items:center;
         padding:14px 16px;background:var(--panel);border-bottom:1px solid var(--border)}
  .brand{display:flex;gap:10px;align-items:center}
  .bvg{width:36px;height:36px;border-radius:8px;background:var(--bvg);color:#000;display:grid;place-items:center;font-weight:900}
  .status{font-variant-numeric:tabular-nums;font-weight:700;border:2px solid var(--border);background:#111;padding:6px 10px;border-radius:10px}
  .status.ok{outline:2px solid var(--ok)} .status.bad{outline:2px solid var(--warn)}
  .seg{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px;background:var(--panel);border-bottom:1px solid var(--border)}
  .seg button{appearance:none;border:1px solid var(--border);background:#0a0e12;color:var(--text);
              padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}
  .seg button.active{background:var(--accent);color:#00121a;border:none}
  .seg button.icon{border-radius:10px;padding:8px 10px}
  .ticker{border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:#111;color:#fff;overflow:hidden}
  .ticker span{display:inline-block;padding:8px 16px;white-space:nowrap;animation:mar 25s linear infinite}
  @keyframes mar{from{transform:translateX(100%)}to{transform:translateX(-100%)}}
  table{width:100%;border-collapse:collapse}
  thead th{position:sticky;top:132px;background:var(--panel);color:var(--muted);padding:10px 12px;border-bottom:1px solid var(--border);text-align:left}
  tbody td{padding:12px;border-bottom:1px solid var(--border)}
  .right{text-align:right}
  .badge{display:inline-block;min-width:44px;text-align:center;font-weight:900;padding:4px 12px;border-radius:10px;background:var(--bvg);color:#111}
  .ghost{opacity:.65} .err{color:var(--warn);font-weight:700;margin:10px 12px 0}
  footer{margin-top:auto;padding:10px 14px;border-top:1px solid var(--border);color:var(--muted);font-size:14px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand"><div class="bvg">BVG</div><div style="font-weight:900">Echtzeit-Anzeige</div></div>
    <div id="status" class="status ghost">lädt…</div>
  </header>

  <!-- Stationen -->
  <div class="seg" role="tablist" aria-label="Stationen">
    <button id="tab-hahneberg" class="active" data-stop="900037203" data-lines="M37,M49">Hahneberg (M37/M49)</button>
    <button id="tab-reimerweg" data-stop="900000037274" data-lines="M137,137">Reimerweg (M137)</button>
  </div>

  <!-- Modus -->
  <div class="seg" role="tablist" aria-label="Modus">
    <button id="tab-dep" class="active" data-mode="departures">Abfahrten</button>
    <button id="tab-arr" data-mode="arrivals">Ankünfte</button>
    <span style="flex:1"></span>
    <button id="tab-refresh" class="icon" title="Neu laden">⟳</button>
  </div>

  <div class="ticker"><span id="ticker">Willkommen! Nächste Aktualisierung alle 20 Sekunden.</span></div>

  <div style="overflow:auto">
    <table aria-live="polite" aria-busy="true">
      <thead>
        <tr><th style="width:12%">Linie</th><th>Ziel</th><th id="th-when" style="width:20%" class="right">Abfahrt</th></tr>
      </thead>
      <tbody id="rows"><tr><td colspan="3" class="ghost">Lade Daten…</td></tr></tbody>
    </table>
  </div>

  <div id="err" class="err" role="alert" aria-live="assertive"></div>
  <footer>Live-Daten: BVG/VBB • Anzeige für Hahneberg & Reimerweg</footer>
</div>

<script>
const API_BASE = 'https://v6.vbb.transport.rest'; // <<< stations-only
const statusEl = document.getElementById('status');
const rowsEl   = document.getElementById('rows');
const errEl    = document.getElementById('err');
const tickerEl = document.getElementById('ticker');
const thWhen   = document.getElementById('th-when');

let currentStop  = document.querySelector('#tab-hahneberg').dataset.stop;
let currentLines = new Set(document.querySelector('#tab-hahneberg').dataset.lines.split(',').map(s=>s.toUpperCase()));
let currentMode  = 'departures';
let timer = null;

// helpers
const fmtTime = iso => new Date(iso).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
const mi
